#!/bin/bash

# –§—É–Ω–∫—Ü–∏–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ä–∞—Å–∫–ª–∞–¥–æ–∫
set_russian_layout() {
    setxkbmap -layout ru,us -variant 'phonetic_winkeys,'
    echo "üá∑üá∫"
}

set_english_layout() {
    setxkbmap -layout us,ru
    echo "üá∫üá∏"
}

# –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–∞—Å–∫–ª–∞–¥–∫–∏
toggle_layout() {
    CURRENT_LAYOUT=$(setxkbmap -query | grep layout | sed 's/,\w\+//gi' | awk '{print $2}')

    if [ "$CURRENT_LAYOUT" = "us" ]; then
        set_russian_layout
    else
        set_english_layout
    fi
}

# –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
if [ $# -gt 0 ]; then
    case "$1" in
    "ru") NEW_LAYOUT=$(set_russian_layout) ;;
    "us") NEW_LAYOUT=$(set_english_layout) ;;
    *) NEW_LAYOUT=$(toggle_layout) ;;
    esac
else
    NEW_LAYOUT=$(toggle_layout)
fi

# –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
dunstify \
    --icon keyboard \
    --urgency low \
    --appname "layout switch" \
    "–†–∞—Å–∫–ª–∞–¥–∫–∞" "$NEW_LAYOUT"
